# 캔버스 기능 명세서

## 1. 기능 현황 요약

| 카테고리 | 전체 | 구현 | 미구현 |
|----------|------|------|--------|
| 방/벽 | 6 | 3 | 3 |
| 가구 | 10 | 6 | 4 |
| 문/창문 | 8 | 6 | 2 |
| 뷰/네비게이션 | 6 | 5 | 1 |
| 측정/치수 | 5 | 2 | 3 |
| 내보내기 | 4 | 0 | 4 |
| 협업 | 5 | 0 | 5 |
| **합계** | **44** | **22** | **22** |

---

## 2. 방/벽 기능

### 2.1 방 생성 ✅ 구현됨

**설명**: 사용자가 입력한 크기로 사각형 방 생성

| 항목 | 내용 |
|------|------|
| 트리거 | "+ 방 만들기" 버튼 클릭 |
| 입력 | 가로(cm), 세로(cm) |
| 출력 | Room 객체 { x, y, width, height } |
| 스케일 | 1cm = 2px |
| 제약 | 방은 1개만 생성 가능 |

```typescript
interface Room {
  x: number      // 캔버스 좌표 (px)
  y: number
  width: number  // 실제크기 * scale
  height: number
}
```

### 2.2 방 크기 표시 ✅ 구현됨

**설명**: 방 가로/세로 실제 치수(cm) 표시

| 항목 | 내용 |
|------|------|
| 위치 | 가로: 방 상단 중앙, 세로: 방 좌측 중앙 |
| 형식 | `{cm}cm` |
| 폰트 | 14px, #374151 |

### 2.3 방 벽 렌더링 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 스타일 | stroke: #374151, strokeWidth: 3 |
| 채우기 | #ffffff |

### 2.4 방 크기 수정 ❌ 미구현

**설명**: 생성된 방의 크기를 드래그 또는 입력으로 변경

| 항목 | 내용 |
|------|------|
| 방법 1 | 모서리/변 드래그로 리사이즈 |
| 방법 2 | 속성 패널에서 수치 입력 |
| 고려사항 | 기존 가구/문 위치 재조정 필요 |

### 2.5 다중 방 지원 ❌ 미구현

**설명**: 여러 개의 방을 연결하여 복잡한 평면도 구성

| 항목 | 내용 |
|------|------|
| 기능 | 방 추가, 방 연결, 벽 공유 |
| 우선순위 | Phase 2 |

### 2.6 방 삭제 ❌ 미구현

**설명**: 생성된 방 삭제 (모든 가구/문 함께 삭제)

---

## 3. 가구 기능

### 3.1 가구 라이브러리 ✅ 구현됨

**설명**: 사전 정의된 가구 목록에서 선택

| 가구 | 크기 (W×D cm) | 색상 |
|------|---------------|------|
| 소파 | 200 × 90 | #6366f1 |
| 싱글 침대 | 100 × 200 | #8b5cf6 |
| 더블 침대 | 150 × 200 | #a855f7 |
| 식탁 | 140 × 80 | #f59e0b |
| 책상 | 120 × 60 | #10b981 |
| 옷장 | 120 × 60 | #6b7280 |
| TV 스탠드 | 150 × 40 | #3b82f6 |
| 책장 | 80 × 30 | #f97316 |
| 의자 | 45 × 45 | #14b8a6 |
| 커피 테이블 | 100 × 50 | #eab308 |

### 3.2 가구 드래그 앤 드롭 배치 ✅ 구현됨

**설명**: 사이드바에서 캔버스로 가구 드래그하여 배치

| 항목 | 내용 |
|------|------|
| 드래그 시작 | `dragstart` 이벤트, JSON 데이터 전달 |
| 드롭 | 캔버스 좌표 계산 후 Furniture 객체 생성 |
| 좌표 변환 | `(clientX - rect.left - stageX) / scale` |

```typescript
interface Furniture {
  id: string
  name: string
  x: number        // 캔버스 좌표
  y: number
  width: number    // 실제 크기 (cm)
  height: number
  color: string
  rotation: number // 0, 90, 180, 270
}
```

### 3.3 가구 이동 ✅ 구현됨

**설명**: 배치된 가구를 드래그하여 위치 변경

| 항목 | 내용 |
|------|------|
| 이벤트 | `dragmove`, `dragend` |
| 스냅 | 이동 중 실시간 스냅 적용 |

### 3.4 가구 회전 ✅ 구현됨

**설명**: 선택된 가구 90도 단위 회전

| 항목 | 내용 |
|------|------|
| 단축키 | `R` |
| 각도 | 0° → 90° → 180° → 270° → 0° |
| 회전 기준점 | 좌측 상단 (Konva 기본값) |

### 3.5 가구 선택 ✅ 구현됨

**설명**: 가구 클릭 시 선택 상태로 전환

| 항목 | 내용 |
|------|------|
| 시각적 피드백 | stroke: #3b82f6, strokeWidth: 3 |
| 정보 표시 | 좌측 상단에 이름, 크기, 단축키 안내 |

### 3.6 가구 삭제 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 단축키 | `Delete` |
| 동작 | 선택된 가구를 목록에서 제거 |

### 3.7 가구 스냅 ✅ 구현됨 (부분)

**설명**: 가구를 벽 또는 다른 가구에 자동 정렬

| 스냅 대상 | 구현 |
|-----------|------|
| 벽 (4면) | ✅ |
| 다른 가구 좌/우 | ✅ |
| 다른 가구 상/하 | ✅ |
| 정렬 (좌측끼리, 우측끼리) | ✅ |

| 항목 | 내용 |
|------|------|
| 스냅 거리 | 15px |
| 회전 고려 | ✅ (바운딩 박스 재계산) |

```typescript
// 회전된 가구의 실제 바운딩 박스 계산
const getFurnitureBounds = (x, y, furniture) => {
  // rotation에 따라 left, top, right, bottom 재계산
}
```

### 3.8 사용자 정의 가구 등록 ❌ 미구현

**설명**: 사용자가 직접 가구 이름/크기/색상 입력하여 등록

| 항목 | 내용 |
|------|------|
| 입력 | 이름, 가로, 세로, 높이(선택), 색상, 사진(선택) |
| 저장 | "내 가구" 목록에 저장 |
| 우선순위 | P0 (MVP) |

### 3.9 가구 복제 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 단축키 | `Ctrl+D` 또는 `Cmd+D` |
| 동작 | 선택된 가구를 약간 오프셋하여 복제 |

### 3.10 가구 크기 조절 ❌ 미구현

**설명**: 배치된 가구의 크기를 드래그로 변경

| 항목 | 내용 |
|------|------|
| 방법 | Konva Transformer 사용 |
| 제약 | 비율 유지 옵션 |

### 3.11 가구 잠금 ❌ 미구현

**설명**: 실수로 이동되지 않도록 위치 고정

---

## 4. 문/창문 기능

### 4.1 문 추가 ✅ 구현됨

**설명**: 벽에 문 배치

| 항목 | 내용 |
|------|------|
| 트리거 | 사이드바 "문 추가" 클릭 |
| 입력 | 벽 선택, 위치(cm), 너비(cm) |
| 기본값 | 너비 90cm |

```typescript
interface Door {
  id: string
  x: number              // 벽 기준 위치 (cm)
  y: number
  width: number          // 문 너비 (cm)
  wall: 'top' | 'bottom' | 'left' | 'right'
  openDirection: 'inside' | 'outside'
  hingeSide: 'left' | 'right'
}
```

### 4.2 문 선택 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 시각적 피드백 | stroke: #3b82f6 |
| 정보 표시 | 열림 방향, 경첩 위치, 단축키 안내 |

### 4.3 문 삭제 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 단축키 | `Delete` |

### 4.4 문 드래그 이동 ✅ 구현됨

**설명**: 문을 드래그하여 다른 벽으로 이동

| 항목 | 내용 |
|------|------|
| 스냅 | 가장 가까운 벽에 자동 스냅 |
| 범위 제한 | 벽 범위 내로 클램핑 |

### 4.5 문 열림 방향 전환 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 단축키 | `D` |
| 옵션 | inside ↔ outside |
| 시각화 | 호(arc)가 방 안/밖으로 변경 |

### 4.6 문 경첩 위치 전환 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 단축키 | `H` |
| 옵션 | left ↔ right |
| 시각화 | 호가 좌/우로 반전 |

### 4.7 창문 추가 ❌ 미구현

**설명**: 벽에 창문 배치

| 항목 | 내용 |
|------|------|
| 입력 | 벽 선택, 위치, 너비 |
| 시각화 | 이중선 또는 유리 표시 |

### 4.8 문/창문 열림 충돌 감지 ❌ 미구현

**설명**: 문이 열릴 때 가구와 충돌하는지 검사

| 항목 | 내용 |
|------|------|
| 검사 | 문 열림 호(arc) 영역과 가구 교차 |
| 경고 | 시각적 표시 + 메시지 |
| 우선순위 | P0 (MVP) |

---

## 5. 뷰/네비게이션 기능

### 5.1 줌 인/아웃 ✅ 구현됨

| 방법 | 동작 |
|------|------|
| 버튼 | +/- 버튼 클릭 |
| 마우스 휠 | 커서 위치 기준 줌 |

| 항목 | 내용 |
|------|------|
| 배율 | 0.3x ~ 3.0x |
| 줌 단위 | 1.1배 또는 1.2배 |

### 5.2 패닝 ✅ 구현됨

**설명**: 캔버스를 드래그하여 뷰 이동

| 항목 | 내용 |
|------|------|
| 트리거 | 빈 공간 클릭 + 드래그 |
| 동작 | stage.x, stage.y 업데이트 |

### 5.3 뷰 리셋 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 트리거 | "리셋" 버튼 |
| 동작 | scale=1, 뷰 중앙 정렬 |

### 5.4 방 생성 후 뷰 조정 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 동작 | 방이 화면 좌측 상단에 위치하도록 뷰 이동 |
| 여백 | 50px |

### 5.5 선택 해제 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 트리거 | 빈 공간 클릭 |
| 동작 | selectedFurniture, selectedDoor = null |

### 5.6 그리드 표시 ❌ 미구현 (코드 있으나 비활성화)

| 항목 | 내용 |
|------|------|
| 간격 | 50px (25cm) |
| 스타일 | 연한 회색 점선 |
| 토글 | 켜기/끄기 옵션 필요 |

---

## 6. 측정/치수 기능

### 6.1 방 크기 치수선 ✅ 구현됨

| 항목 | 내용 |
|------|------|
| 표시 | 가로/세로 cm 값 |
| 위치 | 방 외곽 |

### 6.2 가구 크기 표시 ✅ 구현됨 (정보 패널)

| 항목 | 내용 |
|------|------|
| 표시 | 선택된 가구의 W × D cm |
| 위치 | 좌측 상단 정보 패널 |

### 6.3 가구 간 거리 표시 ❌ 미구현

**설명**: 선택된 가구와 인접 가구/벽 사이 거리 표시

| 항목 | 내용 |
|------|------|
| 표시 | 양방향 화살표 + cm 값 |
| 대상 | 상하좌우 가장 가까운 객체 |
| 우선순위 | P0 (MVP) |

### 6.4 벽까지 거리 표시 ❌ 미구현

**설명**: 선택된 가구에서 각 벽까지의 거리

### 6.5 총 면적 계산 ❌ 미구현

**설명**: 방의 총 면적 (㎡) 표시

| 항목 | 내용 |
|------|------|
| 계산 | width × height / 10000 |
| 표시 | 방 내부 또는 정보 패널 |

---

## 7. 내보내기 기능

### 7.1 PNG 내보내기 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 방법 | Konva stage.toDataURL() |
| 옵션 | 배율, 배경색 |
| 우선순위 | P0 (MVP) |

### 7.2 PDF 내보내기 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 방법 | jsPDF + PNG 변환 |
| 포함 | 평면도 + 가구 목록 |
| 우선순위 | P0 (MVP) |

### 7.3 가구 목록 내보내기 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 형식 | CSV 또는 텍스트 |
| 내용 | 가구명, 크기, 수량 |

### 7.4 프로젝트 저장/불러오기 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 저장 | JSON 형식으로 로컬 또는 서버 |
| 불러오기 | 저장된 프로젝트 복원 |
| 우선순위 | P0 (MVP) |

---

## 8. 협업 기능 (Phase 2)

### 8.1 실시간 커서 표시 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 기술 | Yjs Awareness |
| 표시 | 다른 사용자 커서 위치 + 이름 |

### 8.2 실시간 가구 동기화 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 기술 | Yjs Y.Map |
| 동기화 | 가구 위치, 회전, 추가/삭제 |

### 8.3 댓글 기능 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 기능 | 특정 위치에 댓글 추가 |
| 표시 | 말풍선 아이콘 |

### 8.4 프로젝트 공유 링크 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 생성 | 고유 URL 생성 |
| 권한 | 보기 전용 / 편집 가능 |

### 8.5 변경 이력 ❌ 미구현

| 항목 | 내용 |
|------|------|
| 기능 | Undo/Redo, 버전 히스토리 |

---

## 9. 키보드 단축키 요약

| 단축키 | 대상 | 동작 | 구현 |
|--------|------|------|------|
| `R` | 가구 | 90° 회전 | ✅ |
| `Delete` | 가구/문 | 삭제 | ✅ |
| `D` | 문 | 열림 방향 전환 | ✅ |
| `H` | 문 | 경첩 위치 전환 | ✅ |
| `Ctrl+D` | 가구 | 복제 | ❌ |
| `Ctrl+Z` | 전체 | 실행 취소 | ❌ |
| `Ctrl+Y` | 전체 | 다시 실행 | ❌ |
| `Ctrl+S` | 전체 | 저장 | ❌ |
| `Escape` | 전체 | 선택 해제 | ❌ |

---

## 10. 우선순위별 미구현 기능

### P0 (MVP 필수)

| 기능 | 설명 |
|------|------|
| 사용자 정의 가구 등록 | 내 가구 크기 입력 |
| 문/가구 충돌 감지 | 문 열림 영역 경고 |
| 가구 간 거리 표시 | 선택 시 인접 거리 |
| PNG/PDF 내보내기 | 결과물 다운로드 |
| 프로젝트 저장/불러오기 | 작업 보존 |

### P1 (MVP 후 우선)

| 기능 | 설명 |
|------|------|
| 방 크기 수정 | 생성 후 변경 |
| 창문 추가 | 벽에 창문 배치 |
| 가구 복제 | Ctrl+D |
| Undo/Redo | 실행 취소 |
| 그리드 토글 | 켜기/끄기 |

### P2 (Phase 2)

| 기능 | 설명 |
|------|------|
| 다중 방 | 복잡한 평면도 |
| 실시간 협업 | Yjs 기반 |
| 댓글 | 위치 기반 코멘트 |
| 3D 뷰 | TresJS |
